{"ast":null,"code":"import _objectSpread from \"/Users/alexiaperesson/webgl-things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport * as THREE from 'three';\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport Material from './Material';\nimport { loadShaders, loadAudio } from '../utils';\nconst DEFAULT_SETTINGS = {\n  tesselation: 160,\n  size: 10,\n  noiseScale: 4.27,\n  noiseFrequency: 0.5,\n  noiseOffset: new THREE.Vector3(0.2, 0.2, 0.2)\n};\n\nclass Sphere {\n  constructor() {\n    this.mesh = null;\n    this.lights = null;\n    this.material = new Material();\n    this.uniforms = {\n      noiseScale: DEFAULT_SETTINGS.noiseScale,\n      noiseFrequency: DEFAULT_SETTINGS.noiseFrequency,\n      noiseOffset: DEFAULT_SETTINGS.noiseOffset\n    };\n    this.audio = null;\n    this.audioAnalyser = null;\n  }\n\n}\n\nSphere.prototype.setLights = function (lights) {\n  this.lights = lights;\n};\n\nSphere.prototype.setSound = async function () {\n  const listener = new THREE.AudioListener();\n  this.audio = new THREE.PositionalAudio(listener); // positionalAudio.setMediaElementSource( audioElement );\n  // \t\tpositionalAudio.setRefDistance( 1 );\n  // \t\tpositionalAudio.setDirectionalCone( 180, 230, 0.1 );\n\n  const soundBuffer = await loadAudio('heartbeat.wav');\n  this.audio.setBuffer(soundBuffer);\n  this.audio.play();\n  this.audio.loop = true;\n  this.audio.setRefDistance(0.3);\n  this.audio.setDirectionalCone(180, 230, 0.1);\n  this.audioAnalyser = new THREE.AudioAnalyser(this.audio, 256);\n};\n\nSphere.prototype.initMesh = async function () {\n  const _ref = await loadShaders('sphere'),\n        fragmentShader = _ref.fragmentShader,\n        vertexShader = _ref.vertexShader;\n\n  await this.setSound();\n  const geometry = new THREE.SphereBufferGeometry(DEFAULT_SETTINGS.size, DEFAULT_SETTINGS.tesselation, DEFAULT_SETTINGS.tesselation);\n  BufferGeometryUtils.computeTangents(geometry);\n  const lightUniforms = this.lights ? this.lights.getUniforms() : {};\n  const materialUniforms = this.material.getUniforms();\n  const material = new THREE.ShaderMaterial({\n    uniforms: _objectSpread({\n      uAverageFrequency: {\n        value: this.audioAnalyser.getAverageFrequency()\n      },\n      uNoiseScale: {\n        value: this.uniforms.noiseScale\n      },\n      uNoiseFrequency: {\n        value: this.uniforms.noiseFrequency\n      },\n      uNoiseOffset: {\n        value: this.uniforms.noiseOffset\n      }\n    }, materialUniforms, lightUniforms),\n    vertexShader,\n    fragmentShader\n  });\n  this.mesh = new THREE.Mesh(geometry, material);\n  this.mesh.rotation.x -= Math.PI / 2;\n  this.mesh.add(this.audio);\n};\n\nSphere.prototype.setGui = function (controller) {\n  const sphere = controller.addFolder('Sphere');\n  const noiseFolder = sphere.addFolder('Noise');\n  noiseFolder.add(this.uniforms, 'noiseScale', 0, 10);\n  noiseFolder.add(this.uniforms, 'noiseFrequency', 0, 0.4);\n  this.material.setGui(sphere);\n};\n\nSphere.prototype.animate = function () {\n  if (!this.mesh) return;\n  this.lights.setUniforms(this.mesh.material);\n  this.material.setUniforms(this.mesh.material);\n  this.mesh.material.uniforms['uAverageFrequency'].value = this.audioAnalyser.getAverageFrequency();\n  this.mesh.material.uniforms['uNoiseScale'].value = this.uniforms.noiseScale;\n  this.mesh.material.uniforms['uNoiseOffset'].value.x = this.uniforms.noiseOffset.x += 0.0001;\n  this.mesh.material.uniforms['uNoiseOffset'].value.y = this.uniforms.noiseOffset.y += 0.0001;\n  this.mesh.material.uniforms['uNoiseFrequency'].value = this.uniforms.noiseFrequency;\n};\n\nexport default Sphere;","map":{"version":3,"sources":["/Users/alexiaperesson/webgl-things/src/classes/Sphere.js"],"names":["THREE","BufferGeometryUtils","Material","loadShaders","loadAudio","DEFAULT_SETTINGS","tesselation","size","noiseScale","noiseFrequency","noiseOffset","Vector3","Sphere","constructor","mesh","lights","material","uniforms","audio","audioAnalyser","prototype","setLights","setSound","listener","AudioListener","PositionalAudio","soundBuffer","setBuffer","play","loop","setRefDistance","setDirectionalCone","AudioAnalyser","initMesh","fragmentShader","vertexShader","geometry","SphereBufferGeometry","computeTangents","lightUniforms","getUniforms","materialUniforms","ShaderMaterial","uAverageFrequency","value","getAverageFrequency","uNoiseScale","uNoiseFrequency","uNoiseOffset","Mesh","rotation","x","Math","PI","add","setGui","controller","sphere","addFolder","noiseFolder","animate","setUniforms","y"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\n\nimport Material from './Material';\nimport { loadShaders, loadAudio  } from '../utils';\n\nconst DEFAULT_SETTINGS = {\n    tesselation : 160,\n    size : 10,\n    noiseScale : 4.27,\n    noiseFrequency : 0.5,\n    noiseOffset : new THREE.Vector3(0.2, 0.2, 0.2),\n}\n\nclass Sphere {\n    constructor() {\n        this.mesh = null;\n        this.lights = null;\n        this.material = new Material();\n        this.uniforms = {\n            noiseScale : DEFAULT_SETTINGS.noiseScale,\n            noiseFrequency : DEFAULT_SETTINGS.noiseFrequency,\n            noiseOffset : DEFAULT_SETTINGS.noiseOffset,\n        };\n        this.audio = null;\n        this.audioAnalyser = null;\n    }\n}\n\nSphere.prototype.setLights = function(lights) {\n    this.lights = lights\n}\n\nSphere.prototype.setSound = async function() {\n    const listener = new THREE.AudioListener();\n    this.audio = new THREE.PositionalAudio(listener);\n\n    // positionalAudio.setMediaElementSource( audioElement );\n\t// \t\tpositionalAudio.setRefDistance( 1 );\n\t// \t\tpositionalAudio.setDirectionalCone( 180, 230, 0.1 );\n\n\n    const soundBuffer = await loadAudio('heartbeat.wav');\n    this.audio.setBuffer(soundBuffer);\n    this.audio.play();\n    this.audio.loop = true;\n    this.audio.setRefDistance( 0.3 );\n    this.audio.setDirectionalCone( 180, 230, 0.1 );\n    \n    this.audioAnalyser = new THREE.AudioAnalyser(this.audio, 256);\n}\n\nSphere.prototype.initMesh = async function() {\n    const {fragmentShader, vertexShader} = await loadShaders('sphere');\n\n    await this.setSound();\n\n    const geometry = new THREE.SphereBufferGeometry(DEFAULT_SETTINGS.size, DEFAULT_SETTINGS.tesselation, DEFAULT_SETTINGS.tesselation)\n    BufferGeometryUtils.computeTangents(geometry);\n\n    const lightUniforms = this.lights ? this.lights.getUniforms() : {};\n    const materialUniforms = this.material.getUniforms();\n\n    const material = new THREE.ShaderMaterial({\n        uniforms : {\n            uAverageFrequency : { value : this.audioAnalyser.getAverageFrequency() },\n            uNoiseScale : { value : this.uniforms.noiseScale },\n            uNoiseFrequency : { value : this.uniforms.noiseFrequency },\n            uNoiseOffset : { value : this.uniforms.noiseOffset },\n            ...materialUniforms,\n            ...lightUniforms\n        },\n        vertexShader,\n        fragmentShader,\n    })\n    \n    this.mesh = new THREE.Mesh(geometry, material); \n    this.mesh.rotation.x -= Math.PI / 2;\n    this.mesh.add(this.audio)\n}\n\nSphere.prototype.setGui = function(controller) {\n   const sphere = controller.addFolder('Sphere')\n\n   const noiseFolder = sphere.addFolder('Noise');\n   noiseFolder.add(this.uniforms, 'noiseScale', 0, 10);\n   noiseFolder.add(this.uniforms, 'noiseFrequency', 0, 0.4);\n\n   this.material.setGui(sphere);\n}\n\nSphere.prototype.animate = function() {\n    if (!this.mesh) return ;\n\n    this.lights.setUniforms(this.mesh.material);\n    this.material.setUniforms(this.mesh.material);\n\n    this.mesh.material.uniforms['uAverageFrequency'].value = this.audioAnalyser.getAverageFrequency();\n    this.mesh.material.uniforms['uNoiseScale'].value = this.uniforms.noiseScale;\n    this.mesh.material.uniforms['uNoiseOffset'].value.x = this.uniforms.noiseOffset.x += 0.0001;\n    this.mesh.material.uniforms['uNoiseOffset'].value.y = this.uniforms.noiseOffset.y += 0.0001;\n    this.mesh.material.uniforms['uNoiseFrequency'].value = this.uniforms.noiseFrequency;\n   \n}  \n\n\nexport default Sphere;"]},"metadata":{},"sourceType":"module"}